// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  phone         String?
  country       String?
  password      String
  emailVerified Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  bookings      Booking[]
}

model Booking {
  id              String   @id @default(cuid())
  userId          String?
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Agent Information (for B2B bookings)
  agentId         String?
  agent           Agent?   @relation(fields: [agentId], references: [id], onDelete: SetNull)

  // Guest Information (for non-logged-in users)
  guestName       String?
  guestEmail      String?
  guestPhone      String?

  // Package Details
  packageName     String
  packageId       String?

  // Travel Details
  travelDate      DateTime
  duration        String
  hotelCategory   String   // threestar, fourstar, fivestar

  // Traveler Information
  adults          Int      @default(2)
  children3to5    Int      @default(0)
  children6to10   Int      @default(0)

  // Pricing
  totalPrice      Float
  currency        String   @default("EUR")

  // Agent Commission (for B2B bookings)
  commissionAmount Float?
  commissionRate   Float?

  // Booking Status
  status          BookingStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paidAt          DateTime?     // When agent paid

  // Additional Information
  specialRequests String?  @db.Text

  // Flight & Preferences (JSON format)
  arrivalFlightNumber   String?
  arrivalFlightTime     String?
  departureFlightNumber String?
  departureFlightTime   String?
  dietaryRequirements   String?  @db.Text  // JSON array
  roomPreferences       String?  @db.Text  // Twin beds, King bed, High floor, etc.
  emergencyContactName  String?
  emergencyContactPhone String?
  travelInsurance       Boolean  @default(false)
  celebrationOccasion   String?  // Honeymoon, Anniversary, Birthday, etc.

  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  confirmedAt     DateTime?
  completedAt     DateTime?

  // Booking Reference Number
  referenceNumber String   @unique

  // Relations
  passengers      Passenger[]

  @@index([userId])
  @@index([agentId])
  @@index([guestEmail])
  @@index([status])
  @@index([referenceNumber])
}

model Passenger {
  id                  String   @id @default(cuid())
  bookingId           String
  booking             Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  // Personal Information (as per passport)
  firstName           String
  middleName          String?
  lastName            String
  dateOfBirth         DateTime
  gender              String   // M, F, Other
  nationality         String

  // Passport Information
  passportNumber      String
  passportExpiry      DateTime
  passportIssuingCountry String

  // Passenger Type
  passengerType       PassengerType  // ADULT, CHILD_3_5, CHILD_6_10

  // Metadata
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([bookingId])
}

enum PassengerType {
  ADULT
  CHILD_3_5
  CHILD_6_10
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
}

model ContactInquiry {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String   @db.Text
  source    String?
  replied   Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([email])
  @@index([createdAt])
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Agent {
  id              String      @id @default(cuid())
  email           String      @unique
  password        String

  // Company Details
  companyName     String
  contactName     String
  phone           String
  country         String?
  address         String?     @db.Text

  // Business Details
  commissionRate  Float       @default(10.0)  // Percentage
  status          AgentStatus @default(PENDING)

  // White Label Settings
  logoUrl         String?
  primaryColor    String?
  companyWebsite  String?

  // Metadata
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  approvedAt      DateTime?
  approvedBy      String?     // Admin ID who approved

  // Relations
  bookings        Booking[]

  @@index([email])
  @@index([status])
}

enum AgentStatus {
  PENDING
  ACTIVE
  SUSPENDED
  REJECTED
}

model Package {
  id          String   @id @default(cuid())
  packageId   String   @unique  // 01, 02, etc.
  title       String
  slug        String   @unique
  duration    String
  description String   @db.Text

  // Package Type
  packageType String   @default("WITH_HOTEL")  // WITH_HOTEL or LAND_ONLY

  // Itinerary (JSON format)
  itinerary   String   @db.Text

  // Highlights
  highlights  String   @db.Text

  // Included/Not Included
  included    String   @db.Text
  notIncluded String   @db.Text

  // Destinations (comma-separated)
  destinations String

  // Pricing (JSON format: {threestar: {single: 450, double: 320, triple: 290}, ...} or {perPerson: 350} for land only)
  pricing     String   @db.Text

  // B2B Agent Pricing (Nett rates - lower than public pricing)
  b2bPricing  String?  @db.Text

  // Hotels (JSON format) - Optional for land-only packages
  hotels      String?  @db.Text

  // PDF URL
  pdfUrl      String?

  // Images
  image       String

  // Status
  isActive    Boolean  @default(true)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([packageId])
  @@index([slug])
  @@index([packageType])
}

model Wishlist {
  id        String   @id @default(cuid())
  userId    String
  packageId String
  createdAt DateTime @default(now())

  @@unique([userId, packageId])
  @@index([userId])
  @@index([packageId])
}
